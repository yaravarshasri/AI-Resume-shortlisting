<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Screening Results - Resume Screening AI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .score-badge {
            font-size: 1.1em;
            font-weight: bold;
            min-width: 60px;
        }
        .score-high { background-color: #28a745; }
        .score-medium { background-color: #ffc107; color: #212529; }
        .score-low { background-color: #dc3545; }
        .candidate-row:hover {
            background-color: #f8f9fa;
            cursor: pointer;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .skills-text {
            font-size: 0.9em;
            max-height: 60px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="bg-light">

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="navbar-brand" href="/">
            <i class="fas fa-robot me-2"></i>Resume Screening AI
        </a>
        <div class="navbar-nav ms-auto">
            <a class="nav-link" href="/">
                <i class="fas fa-upload me-1"></i>Upload New
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">

    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2><i class="fas fa-chart-line me-2"></i>Candidate Rankings</h2>
            <p class="text-muted">Candidates ranked by AI match score (highest to lowest)</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="/download-csv" class="btn btn-success me-2" th:if="${candidates != null and !candidates.isEmpty()}">
                <i class="fas fa-download me-1"></i>Download CSV
            </a>
            <a href="/" class="btn btn-primary">
                <i class="fas fa-plus me-1"></i>Screen More
            </a>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4" th:if="${stats}">
        <div class="col-md-3 mb-3">
            <div class="card stats-card">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x mb-2"></i>
                    <h3 th:text="${stats.totalCandidates}">0</h3>
                    <small>Total Candidates</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <i class="fas fa-check-circle fa-2x mb-2"></i>
                    <h3 th:text="${stats.qualifiedCandidates}">0</h3>
                    <small>Qualified (≥60%)</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-warning text-dark">
                <div class="card-body text-center">
                    <i class="fas fa-envelope fa-2x mb-2"></i>
                    <h3 th:text="${stats.emailsSent}">0</h3>
                    <small>Emails Sent</small>
                </div>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <i class="fas fa-percentage fa-2x mb-2"></i>
                    <h3 th:text="${#numbers.formatDecimal(stats.averageScore, 1, 1)} + '%'">0%</h3>
                    <small>Average Score</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Table -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-trophy me-2"></i>Candidate Results
                <span class="badge bg-primary ms-2" th:text="${candidates != null ? candidates.size() : 0}">0</span>
            </h5>
        </div>
        <div class="card-body p-0">

            <!-- No Results Message -->
            <div th:if="${candidates == null or candidates.isEmpty()}" class="text-center py-5">
                <i class="fas fa-search fa-3x text-muted mb-3"></i>
                <h4>No Candidates Found</h4>
                <p class="text-muted">Upload some resumes to see the screening results here.</p>
                <a href="/" class="btn btn-primary">
                    <i class="fas fa-upload me-1"></i>Upload Resumes
                </a>
            </div>

            <!-- Results Table -->
            <div th:if="${candidates != null and !candidates.isEmpty()}" class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-dark">
                    <tr>
                        <th scope="col" style="width: 80px;">#</th>
                        <th scope="col">Name</th>
                        <th scope="col">Email</th>
                        <th scope="col" style="width: 120px;">Score</th>
                        <th scope="col">Skills</th>
                        <th scope="col">Matched Skills</th>
                        <th scope="col" style="width: 100px;">Email</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="candidate, stat : ${candidates}"
                        class="candidate-row"
                        th:data-id="${candidate.id}">
                        <td>
                            <span class="badge bg-secondary" th:text="${stat.count}">1</span>
                        </td>
                        <td>
                            <strong th:text="${candidate.name}">John Doe</strong>
                        </td>
                        <td>
                            <a th:href="'mailto:' + ${candidate.email}"
                               th:text="${candidate.email}">email@example.com</a>
                        </td>
                        <td>
                            <span class="badge score-badge"
                                  th:class="|badge score-badge ${candidate.matchScore >= 70 ? 'score-high' : (candidate.matchScore >= 50 ? 'score-medium' : 'score-low')}|"
                                  th:text="${#numbers.formatDecimal(candidate.matchScore, 1, 1)} + '%'">
                                85%
                            </span>
                        </td>
                        <td>
                            <div class="skills-text" th:text="${candidate.skills}">
                                Java, Spring Boot, MySQL
                            </div>
                        </td>
                        <td>
                            <div class="skills-text text-success" th:text="${candidate.matchedSkills}">
                                Java, Spring Boot
                            </div>
                        </td>
                        <td class="text-center">
                            <span th:if="${candidate.emailSent}" class="text-success">
                                <i class="fas fa-check-circle" title="Email sent"></i>
                            </span>
                            <span th:unless="${candidate.emailSent}" class="text-muted">
                                <i class="fas fa-times-circle" title="Email not sent"></i>
                            </span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="card mt-4" th:if="${candidates != null and !candidates.isEmpty()}">
        <div class="card-body">
            <h6><i class="fas fa-info-circle me-2"></i>Legend</h6>
            <div class="row">
                <div class="col-md-6">
                    <span class="badge score-badge score-high me-2">70%+</span> Excellent match
                    <br>
                    <span class="badge score-badge score-medium me-2">50-69%</span> Good match
                    <br>
                    <span class="badge score-badge score-low me-2">0-49%</span> Poor match
                </div>
                <div class="col-md-6">
                    <i class="fas fa-check-circle text-success me-2"></i> Shortlisting email sent
                    <br>
                    <i class="fas fa-times-circle text-muted me-2"></i> Email not sent (score &lt; 60%)
                    <br>
                    <small class="text-muted">
                        <i class="fas fa-info-circle me-1"></i>
                        Candidates with ≥60% score automatically receive shortlisting emails
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
    document.querySelectorAll('.candidate-row').forEach(row => {
        row.addEventListener('click', function() {
            const candidateId = this.dataset.id;
            console.log('Clicked candidate ID:', candidateId);
        });
    });

    const hasResults = [[${candidates != null and !candidates.isEmpty()}]];
    if (hasResults) {
        setTimeout(() => {
            window.location.reload();
        }, 30000);
    }
</script>
</body>
</html>
